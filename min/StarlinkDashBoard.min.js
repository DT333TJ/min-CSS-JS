!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.StarlinkDashBoard=t():e.StarlinkDashBoard=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,a)=>{for(var i in a)e.o(a,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:a[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>l});const a=document.location.origin||window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),i=document.documentElement.clientWidth,s=document.documentElement.clientHeight,r=-1!==location.href.indexOf("taikang")?"http://10.132.23.192/starlinkdashboard":"http://10.154.31.90/starlinkdashboard";function n(e){document.querySelector("#starlinkdashboard-iframe-container").setAttribute("style",{true:"left: 0",false:"left: 100%"}[e]),document.querySelector("#dashboard-iframe-close-btn").setAttribute("style",{true:"visibility: visible",false:"visibility: hidden"}[e])}function o(e,t){var a=e.substring(e.indexOf("?")+1).split("&");for(let e=0;e<a.length;e++){const i=a[e].split("=");if(i[0]===t)return i[1]}}class l{constructor(e={}){this.options={systemCode:"",title:"星链看板",commonOriSelfPageJump:"_blank",commonOriOtherPageJump:"_blank",...e},this.storageFlag=!1,this.initFlag=!1,this.openStatus=!1,this.openDrawer=this.openDrawer.bind(this),this.closeDrawer=this.closeDrawer.bind(this),this.onMessageHandle=this.onMessageHandle.bind(this),this.onVisibilityChangeHandle=this.onVisibilityChangeHandle.bind(this),this.init()}init(){this.bind();let e=r+"/starlinkEntry/starlinkEntry.css",{systemCode:t,title:a}=this.options;t?this.initEntryElement(e,a):window.alert("星链看板初始化不成功，缺少系统编码参数")}bind(){window.addEventListener("message",this.onMessageHandle,!1),document.addEventListener("visibilitychange",this.onVisibilityChangeHandle)}initEntryElement(e,t){[{createEle:"link",targetEle:"head",attribute:{rel:"stylesheet",type:"text/css",href:e}},{createEle:"div",targetEle:"body",attribute:{id:"starlinkdashboard-iframe-container",className:"dashboard-iframe-containerClass",style:"visibility: hidden"}},{createEle:"span",targetEle:"#starlinkdashboard-iframe-container",attribute:{id:"dashboard-iframe-close-btn",className:"dashboard-iframe-close-btn",title:`关闭${t}`,innerText:"✖",style:"visibility: hidden"},handleName:"iframeButtonHandle"},{createEle:"div",targetEle:"#starlinkdashboard-iframe-container",attribute:{id:"starlinkdashboard-iframe-widget",width:"0",height:"100%"}}].map((e=>{this.insertElement(e)}))}insertElement(e){let{createEle:t,targetEle:a,attribute:i,handleName:s}=e;const r=document.createElement(t);i&&Object.keys(i).map((e=>{r[e]=i[e]})),document.querySelector(a).appendChild(r),s&&this.handleEvent(r,s)}handleEvent(e,t){"iframeButtonHandle"===t&&this.iframeButtonHandle(e)}iframeButtonHandle(e){e.onclick=e=>{e.preventDefault(),this.closeDrawer()}}closeDrawer(){n("false"),document.querySelector("#starlinkdashboard-iframe-widget").innerHTML="",sessionStorage.removeItem("starlinkdashboard-storage-urls"),this.openStatus=!1,this.initFlag=!1}openDrawer(e){if(this.openStatus)return;let{params:t}=e,a=function(e){let t="";for(let[a,i]of Object.entries(e))t+=`${a}=${i}&`;return t}(t),i=this.options.systemCode,s=(-1!==location.href.indexOf("taikang")?"http://oa.taikang.com/starlinkdashboard":"http://oa.tkuat.com/starlinkdashboard")+`/${i}/dashboard?${a}`+`currentDashboard=${i}&oriDashboard=${i}&storageID=${(new Date).valueOf()}&storageIndex=0`;this.initIframeElementAndUrl(s),this.openStatus||(n("true"),this.openStatus=!0)}initIframeElementAndUrl(e){document.querySelector("#starlinkdashboard-iframe-widget").innerHTML="",e=e.endsWith("&")?e.substring(0,e.length-1):e;let t={createEle:"iframe",targetEle:"#starlinkdashboard-iframe-widget",attribute:{id:"starlinkdashboard-iframe",className:"dashboard-iframe-widgetClass",width:i+"px",height:s+"px",frameborder:"0",scrolling:"no",style:"border: none",seamless:"seamless",src:e}};this.insertElement(t),document.getElementById("starlinkdashboard-iframe").onload=()=>{this.initFlag||(this.initFlag=!0)}}postMessageHandle(e){e.targetOrigin=a,e.postMessageName="starlinkdashboard",document.getElementById("starlinkdashboard-iframe").contentWindow.postMessage(e,"*")}onMessageHandle(e){let t=e.data;if(e.origin===t.targetOrigin&&"starlinkdashboard"===t.postMessageName){if("init"===t.postMessageType&&t.params){let{url:e}=t.params;this.storageUrl(e)}if("fallback"===t.postMessageType&&t.params){let{url:e}=t.params;this.initIframeElementAndUrl(e)}if("jumpDashboard"===t.postMessageType&&t.params){let{url:e}=t.params;this.initIframeElementAndUrl(e)}if("jumpOtherSystemPage"===t.postMessageType&&t.params){let{url:e}=t.params;"_blank"!==this.options.commonOriOtherPageJump&&this.closeDrawer(),window.open(e,this.options.commonOriOtherPageJump)}}}storageUrl(e){let t=JSON.parse(sessionStorage.getItem("starlinkdashboard-storage-urls"))||{},a=o(e,"storageID")||"",i=o(e,"storageIndex")||"",s=t.urls||[];a&&(t.storageID!==a+""&&(t={}),t.storageID=a,i?s[i]=e:s.push(e),t.urls=s,sessionStorage.setItem("starlinkdashboard-storage-urls",JSON.stringify(t)),this.openStatus&&this.postMessageHandle({storage:!0,storageData:JSON.stringify(t)}))}onVisibilityChangeHandle(e){"visible"===document.visibilityState&&this.openStatus&&this.postMessageHandle({refresh:!0}),"hidden"===document.visibilityState&&this.openStatus&&this.postMessageHandle({resetRefresh:!0})}}return t.default})()}));